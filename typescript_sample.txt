import express from 'express';
import sharp from 'sharp';
//import fs from 'fs';

const app = express();

app.get('/api/images', (req, res) => {
  const { filename, width, height } = req.query;

  sharp(`./images/${filename}`)
    .resize(Number(width), Number(height))
    .toBuffer()
    .then((data) => {
      const imgSrc = `data:image/jpeg;base64,${data.toString('base64')}`;
      res.send(`
        <!DOCTYPE html>
        <html>
          <head>
            <title>Example Page</title>
          </head>
          <body>
            <h1>Hello Image</h1>
            <img src="${imgSrc}" alt="Thumb of requested image">
          </body>
        </html>
      `);
    })
    .catch((error) => {
      res.status(500).send(error);
    });
});

app.listen(3000, () => {
  console.log('Server listening on port 3000');
});
